components:
  schemas:
    Topics:
      type: object
      required:
        - organizationName
        - allowUndefinedTopics
        - topics
        - version
      properties:
        organizationName:
          type: string
        allowUndefinedTopics:
          type: boolean
        undefinedTopic:
          $ref: '#/components/schemas/Topic'
        topics:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Topic'
        version:
          type: integer
          format: int64
    Topic:
      type: object
      properties:
        batch:
          $ref: '#/components/schemas/TopicBatch'
        streams:
          type: array
          items:
            $ref: '#/components/schemas/TopicStream'
        store:
          $ref: '#/components/schemas/TopicStore'
    TopicBatch:
      type: object
      properties:
        retentionInDays:
          type: integer
          format: int64
    TopicStream:
      type: object
      required:
        - name
      properties:
        name:
          type: string
    TopicStore:
      type: object
      required:
        - keys
        - ttlInSec
      properties:
        keys:
          type: array
          items:
            $ref: '#/components/schemas/TopicStoreKey'
        ttlInSec:
          type: integer
          format: int64
        blacklist:
          type: array
          items:
            type: string
        whitelist:
          type: array
          items:
            type: string
    TopicStoreKey:
      type: object
      required:
        - tableType
        - pkParts
        - rangePrefix
      properties:
        tableType:
          type: string
          enum:
            - PRIMARY
            - GSI
            - LSI
        indexNumber:
          type: integer
          format: int64
        pkParts:
          type: array
          items:
            type: string
        skParts:
          type: array
          items:
            type: string
        rangePrefix:
          type: string
    TopicSchema:
      type: object
      required:
        - schema
        - format
      properties:
        schema:
          type: string
        format:
          $ref: '#/components/schemas/SchemaFormat'
    UpdateTopicSchemaRequest:
      type: object
      required:
        - schema
        - format
      properties:
        schema:
          type: string
        format:
          $ref: '#/components/schemas/SchemaFormat'
    SchemaFormat:
      type: string
      enum:
        - JSON

/v1/organization/{organizationName}/topics:
  get:
    operationId: getTopics
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Ok
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Topics'

/v1/organization/{organizationName}/topic/default:
  patch:
    operationId: updateDefaultTopic
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      - name: expectedVersion
        in: query
        required: false
        schema:
          type: integer
          format: int64
    requestBody:
      required: true
      content:
        application/json:
          schema:
            title: UpdateDefaultTopicRequest
            type: object
            required:
              - allowUndefined
            properties:
              allowUndefined:
                type: boolean
              topic:
                $ref: '#/components/schemas/Topic'
    responses:
      '200':
        description: Ok
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Topics'
/v1/organization/{organizationName}/topic/{topicName}:
  patch:
    operationId: updateTopic
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      - name: topicName
        in: path
        required: true
        schema:
          type: string
      - name: expectedVersion
        in: query
        required: false
        schema:
          type: integer
          format: int64
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Topic'
    responses:
      '200':
        description: Ok
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Topics'
  delete:
    operationId: deleteTopic
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      - name: topicName
        in: path
        required: true
        schema:
          type: string
      - name: expectedVersion
        in: query
        required: false
        schema:
          type: integer
          format: int64
    responses:
      '200':
        description: Ok
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Topics'
/v1/organization/{organizationName}/topic/{topicName}/schema:
  get:
    operationId: getTopicSchema
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      - name: topicName
        in: path
        required: true
        schema:
          type: string
    responses:
      '200':
        description: Ok
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TopicSchema'
      '404':
        description: Schema not found
  put:
    operationId: updateTopicSchema
    tags: [ Control ]
    parameters:
      - name: organizationName
        in: path
        required: true
        schema:
          type: string
      - name: topicName
        in: path
        required: true
        schema:
          type: string
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/UpdateTopicSchemaRequest'
    responses:
      '201':
        description: Schema created
      '200':
        description: Schema unchanged or not needed
      '400':
        description: Schema validation failed